# Zeek XDP Filtering

Using XDP to drop packets for now:

```
global xdp_prog: opaque of XDP::Program;

event zeek_init() {
    local opts: XDP::ShuntOptions = [$attach_mode = XDP::SKB];
    xdp_prog = XDP::start_shunt(opts);
}

event http_request(c: connection, method: string, original_URI: string,
    unescaped_URI: string, version: string)
    {
    print fmt("HTTP request: %s %s (%s->%s)", method, original_URI, c$id$orig_h,
        c$id$resp_h);
    XDP::shunt_conn_id(xdp_prog, c$id);
    }

event zeek_done() {
    XDP::end_shunt(xdp_prog);
}
```

## TODOs

- Combine source/dest subnets to just pairs, so it only counts if it's between the two subnets
- Allow initial BPF map state
- Test it
